!function(){"use strict";function e(e){this.init(e)}e.prototype={init:function(e=null){this.bindEvents(e)},bindEvents:function(e=null){let t=e||document,r=this;t.querySelectorAll(".em-timeranges-editor").forEach(e=>{if(e.addEventListener("click",function(e){if(e.target.matches(".em-timerange-add")||e.target.closest(".em-timerange-add")){e.preventDefault();let t=e.target.matches(".em-timerange-add")?e.target:e.target.closest(".em-timerange-add");r.addTimerange(t),r.updatePreview(e.target)}}),e.addEventListener("click",function(e){if(e.target.matches(".em-timerange-delete")||e.target.closest(".em-timerange-delete")){e.preventDefault();let t=e.target.matches(".em-timerange-delete")?e.target:e.target.closest(".em-timerange-delete"),n=t.closest(".em-timeranges");r.deleteTimerange(t),r.updatePreview(n)}e.target.matches(".em-timerange-editor-edit")&&r.openUnlockModal(e.target)}),e.querySelector(".em-timeranges-editor-modal")?.addEventListener("click",function(e){e.target.matches("button.unlock-confirm")?r.unlockEditor(e.target):e.target.matches("button.unlock-cancel")&&closeModal(e.currentTarget)}),e.addEventListener("change",function(e){e.target.matches(".em-time-start, .em-time-end, .em-time-all-day")&&(r.validateTimeRanges(e.target),r.updatePreview(e.target))}),e.addEventListener("change",function(e){e.target.matches(".em-timerange-duration, .em-timerange-buffer, .em-timerange-frequency, .em-timerange-duration-unit, .em-timerange-buffer-unit, .em-timerange-frequency-unit, .em-timerange-overlap")&&(r.updatePreview(e.target),e.target.matches(".em-timerange-duration-unit")&&r.syncFrequencyUnit(e.target))}),e.addEventListener("input",function(e){e.target.matches(".em-time-start, .em-time-end")&&r.updatePreview(e.target)}),e.addEventListener("input",function(e){e.target.matches(".em-timerange-duration")&&(r.syncFrequencyWithDuration(e.target),r.updatePreview(e.target))}),e.addEventListener("change",function(e){e.target.matches('.em-timerange-timeslots-trigger input[type="checkbox"]')?r.handleAdvancedToggle(e.target):e.target.matches('.em-timerange-allday input[type="checkbox"]')&&(r.handleAllDayToggle(e.target),r.updatePreview(e.target))}),e.addEventListener("click",function(e){if(e.target.matches(".em-timeranges-preview-toggle")||e.target.closest(".em-timeranges-preview-toggle")){e.preventDefault();let t=e.target.matches(".em-timeranges-preview-toggle")?e.target:e.target.closest(".em-timeranges-preview-toggle");r.togglePreview(t)}}),e.querySelectorAll(".em-timerange .em-time-start").forEach(e=>{r.updatePreview(e)}),e.classList.contains("disabled")){let t="input[name], .em-timeranges select, .em-timeranges button:not(.em-timerange-editor-edit), .em-timeranges-actions button";e.querySelectorAll(t).forEach(e=>{e.disabled=!0})}})},openUnlockModal:function(e){let t=e.closest(".em-timeranges-editor"),r=e.closest(".em-timeranges-editor").querySelector(".em-timeranges-editor-modal");r.editor=t,openModal(r),r.addEventListener("em_modal_close",function(){t.append(r)},{once:!0})},unlockEditor:function(e){let t=e.closest(".em-timeranges-editor-modal");t.editor.classList.remove("disabled"),t.editor.querySelectorAll("[disabled]").forEach(e=>{e.disabled=!1});let r=t.editor.querySelector(".em-timeranges");r.insertBefore(t.querySelector(".timeranges-edit-action"),r.firstElementChild.nextSibling);let n=t.editor.querySelector(".em-timeranges-editor-nonce");n?n.value=n.dataset.nonce:alert("ERROR: No nonce found for timeranges edit, editing not possible and your changes will not be saved. Contact an administrator about this."),closeModal(t)},addTimerange:function(e){let t=e.closest(".em-timeranges-editor").querySelector(".em-timeranges"),r=t.querySelector("template"),n=parseInt(t.dataset.index||"0",10)+1;if(r){let e=r.innerHTML.replace(/\[X\]/g,`[${n}]`),c=document.createElement("div");c.innerHTML=e;let a=c.firstElementChild;r.before(a),em_setup_ui_elements(a);let l=a.querySelector(".em-timerange-duration");l&&this.syncFrequencyWithDuration(l),t.querySelectorAll('.em-timerange-allday input[type="checkbox"]').forEach(e=>{e.checked&&e.click()}),t.dataset.index=n,t.dataset.count=t.querySelectorAll("& > .em-timerange").length;let i=a.querySelector(".em-time-start");i&&this.updatePreview(i);let s=new CustomEvent("timerange:added",{detail:{timerange:a,index:n}});t.dispatchEvent(s)}},deleteTimerange:function(e){let t=e.closest(".em-timeranges-editor").querySelector(".em-timeranges"),r=t.querySelectorAll("& > .em-timerange").length,n=e.closest(".em-timerange");if(r>1){let e=n.querySelector(".em-timerange-delete-nonce");e&&(e.value=e.dataset.nonce,t.append(e)),n.remove(),r--,t.dataset.count=t.querySelectorAll("& > .em-timerange").length;let c=new CustomEvent("em_timerange:deleted",{detail:{count:r}});t.dispatchEvent(c)}},handleAdvancedToggle:function(e){let t=e.closest(".em-timerange");if(e.checked){t.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(e=>{e.value="",e.setAttribute("placeholder","0")});let e=t.querySelector('.em-timerange-allday input[type="checkbox"]');e&&e.checked&&(e.checked=!1,e.dispatchEvent(new Event("change",{bubbles:!0})))}else t.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(e=>{e.value="",e.setAttribute("placeholder","0")}),this.updatePreview(e)},handleAllDayToggle:function(e){if(e.checked){let t=e.closest(".em-timerange");t.querySelectorAll('.em-timerange-timeslots input[type="text"]').forEach(e=>{e.value="",e.setAttribute("placeholder","0")});let r=t.querySelector('.em-timerange-timeslots-trigger input[type="checkbox"]');r&&r.checked&&(r.checked=!1,r.dispatchEvent(new Event("change",{bubbles:!0})))}},validateTimeRanges:function(e){let t=e.closest(".em-timeranges");if(!t)return;let r=t.querySelectorAll(".em-timerange"),n=!1;r.forEach(e=>{e.querySelectorAll(".em-time-start, .em-time-end").forEach(e=>{e.classList.remove("error")})});let c=[];r.forEach((e,t)=>{let r=e.querySelector(".em-time-start"),n=e.querySelector(".em-time-end");r&&n&&r.value&&n.value&&c.push({index:t,start:this.timeToMinutes(r.value),end:this.timeToMinutes(n.value),startInput:r,endInput:n})});for(let e=0;e<c.length;e++)for(let t=e+1;t<c.length;t++){let r=c[e],a=c[t];this.rangesOverlap(r,a)&&(r.startInput.classList.add("error"),r.endInput.classList.add("error"),a.startInput.classList.add("error"),a.endInput.classList.add("error"),n=!0)}return!n},timeToMinutes:function(e){if(!e)return 0;let t=e.toLowerCase().replace(/\s/g,"").match(/^(\d{1,2}):?(\d{2})?\s*(am|pm)?$/);if(!t)return 0;let r=parseInt(t[1]),n=parseInt(t[2]||0),c=t[3];return"pm"===c&&12!==r&&(r+=12),"am"===c&&12===r&&(r=0),60*r+n},rangesOverlap:function(e,t){let r=e.start,n=e.end,c=t.start,a=t.end;return n<r&&(n+=1440),a<c&&(a+=1440),r<a&&c<n},syncFrequencyWithDuration:function(e){let t=e.closest(".em-timerange");if(t){let r=t.querySelector(".em-timerange-frequency");r&&(r.placeholder=e.value||"0")}},syncFrequencyUnit:function(e){let t=e.closest(".em-timerange")?.querySelector(".em-timerange-frequency-unit");t&&!t.previousElementSibling?.value&&(t.value=e.value)},updatePreview:function(e){let t=e.closest(".em-timeranges-editor"),r=t.querySelector(".em-timeranges-preview"),n=r.querySelector(".em-timeranges-preview-content");if(!n)return;let c=t.querySelector(".em-timeranges"),a=c.querySelectorAll(".em-timerange"),l=[],i=null,s=null,o=null,d=null,u=!1;a.forEach(e=>{let t=e.querySelector(".em-time-start"),r=e.querySelector(".em-time-end"),n=this.getTimeValue(e,"duration"),c=this.getTimeValue(e,"buffer"),a=this.getTimeValue(e,"frequency");if(t.value){let e=this.timeToMinutes(t.value);null===i||e<i?(i=e,d=t.value,t.classList.add("earliest-time")):t.classList.remove("earliest-time")}if(r.value){let e=this.timeToMinutes(r.value);null===s||e>s?(s=e,o=r.value,r.classList.add("latest-time")):r.classList.remove("latest-time")}if(e.querySelector('.em-timerange-allday input[type="checkbox"]')?.checked&&(u=!0),n||a){let e=this.generateTimeranges(t.value,r.value,n,c,a);l.push(...e)}else{let e=this.timeToMinutes(t.value);l.push(e)}});let m=[...new Set(l)];m.sort((e,t)=>e-t),m=m.map(e=>this.formatTimeRange(e)),c.dataset.start=d,c.dataset.end=o,c.dataset.allday=u?1:0,r.classList.toggle("hidden",0===m.length||1===m.length&&1===a.length),n.innerHTML=m.join(""),r.querySelector(".em-timeranges-preview-count").textContent=m.length},formatSingleTime:function(e){if(!e)return"";let t=this.timeToMinutes(e),r=Math.floor(t/60),n=r>=12?"PM":"AM";return`${r>12?r-12:0===r?12:r}:${(t%60).toString().padStart(2,"0")} ${n}`},getTimeValue:function(e,t){let r=e.querySelector(`.em-timerange-${t}`),n=e.querySelector(`.em-timerange-${t}-unit`);if(!r||!n||!r.value)return 0;let c=parseInt(r.value);switch(n.value){case"H":return 60*c;case"I":default:return c;case"S":return Math.round(c/60)}},generateTimeranges:function(e,t,r,n,c){let a=this.timeToMinutes(e),l=this.timeToMinutes(t),i=[];if(l>=a){let e=a;if(e===l)i.push(e);else{let t=c>0?c:r+(n||0);for(let r=0;e<=l;r++)i.push(e),e+=t}}return i},formatTimeRange:function(e,t=null){let r=e=>{(e%=1440)<0&&(e+=1440);let t=Math.floor(e/60),r=t>=12?"PM":"AM";return`${t>12?t-12:0===t?12:t}:${(e%60).toString().padStart(2,"0")} ${r}`},n=`<span class="em-timeranges-preview-time">${r(e)}`;return t&&(n+=` - ${r(t)}`),n+="</span>",n},togglePreview:function(e){let t=e.closest(".em-timeranges-preview").querySelector(".em-timeranges-preview-content"),r=e.querySelector(".em-icon-chevron-down, .em-icon-chevron-up");if(t.classList.contains("hidden")){t.classList.remove("hidden"),r&&(r.className=r.className.replace("chevron-down","chevron-up"));let n=e.closest(".em-timeranges-editor");if(n){let e=n.querySelector(".em-timerange .em-time-start");e&&this.updatePreview(e)}}else t.classList.add("hidden"),r&&(r.className=r.className.replace("chevron-up","chevron-down"))}},document.addEventListener("em_event_editor_ready",()=>{window.EM_TimerangesEditor=new e}),document.addEventListener("em_setup_ui_elements",function(t){t.detail.container!==document&&(window.EM_TimerangesEditor=new e(t.detail.container))})}(),document.addEventListener("em_event_editor_ready",function(){document.querySelectorAll(".em-recurrence-sets").forEach(function(e){e.querySelector('.em-recurrence-set[data-type="include"]:first-child').dataset.primary="1",document.dispatchEvent(new CustomEvent("em_event_editor_recurrences",{detail:{recurrenceSets:e}}))}),document.querySelectorAll('select[name="event_active_status"]').forEach(e=>{e.addEventListener("change",function(t){"0"!==e.value||confirm(EM.event_cancellations.warning.replace(/\\n/g,"\n"))||t.preventDefault()})}),document.getElementById("em-event-recurring-hide")?.setAttribute("disabled",""),document.querySelectorAll(".event_type").forEach(e=>{const t=e.closest("form");e.addEventListener("change",function(){if(r()){let e,r=t.querySelector(".event-form-when"),n=r.querySelector(".em-datepicker.em-event-dates");e=n.classList.contains("em-datepicker-until")?[n.querySelector(".em-date-input-start.flatpickr-input")._flatpickr.selectedDates[0],n.querySelector(".em-date-input-end.flatpickr-input")._flatpickr.selectedDates[0]]:n.querySelector(".em-date-input.flatpickr-input")._flatpickr.selectedDates;let c=r.querySelector(".em-time-range"),a=c.querySelector(".em-time-input.em-time-start"),l=c.querySelector(".em-time-input.em-time-end"),i=c.querySelector("input.em-time-all-day"),s=r.querySelector("select.event_timezone")?.value,o=r.querySelector("select.event_active_status")?.value,d=!1,u=t.querySelector('.em-recurrence-set[data-primary="1"]');if(u){let t=u.querySelector(".em-recurrence-advanced .em-time-range");if(t){let e=t.querySelector(".em-time-input.em-time-start"),r=t.querySelector(".em-time-input.em-time-end"),n=t.querySelector(".em-time-all-day");e&&(e.value=a?.value),r&&(r.value=l?.value),n&&(n.checked=i?.checked)}if("on"===u.querySelector("select.recurrence_freq")?.value){let t=u.querySelector(".em-on-selector .em-date-input.flatpickr-input")?._flatpickr;t?.selectedDates||(t?.setDate(e,!0),d=!0)}else u.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(t=>{t._flatpickr?.selectedDates.length||(t.closest(".em-datepicker-until")?(t._flatpickr.setDate(t.classList.contains("em-date-input-start")?e[0]:e[1],!0),d=!0):t.closest(".em-datepicker-range")&&(t._flatpickr.setDate(e,!0),d=!0))});["select.recurrence_timezone","select.recurrence_status"].forEach(e=>{let t=u.querySelector(e),r="select.recurrence_timezone"===e?s:o;r&&t&&(t.selectize?t.selectize.setValue(r,!0):t.value=r)}),d||u.closest(".em-recurrence-sets").dispatchEvent(new CustomEvent("setDateTimes"))}}});let r=function(){let r=!1;return t&&(r="checkbox"===e.type?e.checked:"single"!==e.value,t.classList.toggle("em-is-recurring",r),"checkbox"===e.type&&t.classList.toggle("em-type-recurring",e.checked),t.classList.remove(...[...t.classList].filter(e=>e.startsWith("em-type-"))),t.classList.add("em-type-"+e.value)),r};r()}),document.querySelectorAll(".em-convert-recurrence-link").forEach(e=>{e.addEventListener("click",function(e){if(!confirm(EM.convert_recurring_warning))return e.preventDefault(),!1;let t=this.getAttribute("data-nonce");t&&(this.href=this.href.replace("nonce=x","nonce="+t))})}),document.dispatchEvent(new CustomEvent("em_event_editor_loaded"))}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets,r=()=>t.dispatchEvent(new CustomEvent("updateSetsCount")),n=function(e){let n,c=t.querySelector(".em-recurrence-type-"+e+" .em-recurrence-type-sets"),a=c.querySelectorAll(".em-recurrence-set").length+1,l=t.querySelector(".em-recurrence-set-template")?.innerHTML;if(null===l){let r=t.querySelector(".em-recurrence-set-template").cloneNode(!0);r.classList.remove("em-recurrence-set-template","hidden"),r.innerHTML=r.innerHTML.replace(/T%/g,`${e}`).replace(/N%/g,`${a}`)}else n=document.createElement("div"),n.innerHTML=l.replace(/T%/g,`${e}`).replace(/N%/g,`${a}`);n.classList.add("em-recurrence-set","new-recurrence-set"),n.querySelector(".em-recurrence-set-type").value=e,n.dataset.type=e,n.dataset.index=a,"exclude"===e&&n.querySelectorAll(".em-recurrence-advanced .only-include-type").forEach(e=>e.remove()),"include"===e&&n.querySelectorAll(".em-recurrence-advanced .only-exclude-type").forEach(e=>e.remove());let i={recurrenceSet:n,index:a,success:!0};return c.dispatchEvent(new CustomEvent("beforeAddRecurrence",{detail:i})),i.success&&(c.append(n),em_setup_ui_elements(n),r(),emRecurrenceEditor.updateIntervalDescriptor(n),emRecurrenceEditor.updateIntervalSelectors(n),emRecurrenceEditor.updateDurationDescriptor(n),(e=>{e.dispatchEvent(new CustomEvent("updateRecurrenceSummary",{bubbles:!0}))})(n)),n};t.querySelectorAll('.em-add-recurrence-set[data-type="include"]').forEach(function(e){e.addEventListener("click",()=>n("include"))}),t.addEventListener("addRecurrence",e=>n(e.detail.type)),t.addEventListener("click",function(e){if(e.target.matches(".em-recurrence-set-action-remove")){let n=e.target;e.preventDefault();let c=n.closest(".em-recurrence-set"),a=c.querySelector("input.em-recurrence-set-id"),l=c.querySelector("input.em-recurrence-set-delete-field");a&&l&&(l.value=l.getAttribute("data-nonce"),t.appendChild(l),t.appendChild(a)),c.remove(),r(),t.dispatchEvent(new CustomEvent("updateRecurrenceOrder"))}})}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets;t.querySelectorAll(".em-recurrence-type-sets").forEach(function(e){let r=null,n=null,c=0,a=0,l=null,i=null;function s(t){if(!r)return;r.style.left=t.pageX-c+"px",r.style.top=t.pageY-a+"px";let l=Array.from(e.querySelectorAll(".em-recurrence-set")),i=!1;for(let r of l){let c=r.getBoundingClientRect(),a=c.top+window.pageYOffset;if(t.pageY<a+c.height/2){e.insertBefore(n,r),i=!0;break}}i||e.appendChild(n)}function o(c){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o),e.insertBefore(r.firstElementChild,n),r.remove(),n.remove(),n=null,r=null,e.querySelectorAll(".em-recurrence-set").forEach(function(e){e.matches(":first-child")?(e.dataset.primary="1",e.querySelectorAll(".em-time-all-day").forEach(e=>{e.indeterminate=!1})):delete e.dataset.primary,e.classList.remove("reordering")}),t.dispatchEvent(new CustomEvent("updateRecurrenceOrder"))}e.addEventListener("mousedown",function(t){e.querySelectorAll(".em-recurrence-set:not(:first-child)").forEach(e=>e.classList.add("reordering"));const d=t.target.closest(".em-recurrence-set-action-order");if(!d)return;const u=d.closest(".em-recurrence-set");if(!u)return;t.preventDefault(),l=u.parentNode,i=u.nextSibling;const m=u.getBoundingClientRect();c=t.pageX-(m.left+window.pageXOffset),a=t.pageY-(m.top+window.pageYOffset),r=document.createElement("div"),r.classList.add("em","em-recurrence-sets"),r.append(u),n=document.createElement("div"),n.classList.add("drop-placeholder"),n.style.height=m.height+"px",n.style.width=m.width+"px",l.insertBefore(n,i),document.body.appendChild(r),r.style.position="absolute",r.style.width="100%",r.style.left=m.left+window.pageXOffset+"px",r.style.top=m.top+window.pageYOffset+"px",r.style.zIndex="1000",document.addEventListener("mousemove",s),document.addEventListener("mouseup",o)})})}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets,r=t.querySelector(".em-recurrence-type-exclude"),n=r.querySelector("& > .em-recurrence-set-reshedule-modal"),c=n.querySelector(".recurrence-reschedule-action");t.querySelectorAll("button.undo").forEach(function(e){e.addEventListener("click",()=>{e.closest(".em-recurrence-set, .em-recurrence-type, .em-recurrence-sets")?.dispatchEvent(new CustomEvent("undo",{detail:{button:e},bubbles:!0}))})}),t.addEventListener("undo",function(e){let a;e.stopPropagation(),a=e.target.matches(".em-recurrence-set")?[e.target]:e.target.matches(".em-recurrence-type")?e.target.querySelectorAll(".em-recurrence-set"):t.querySelectorAll(".em-recurrence-set"),a.forEach(function(e){e.querySelectorAll('[data-undo]:not([type="checkbox"]):not(.selectized)').forEach(e=>{e.value=e.dataset.undo,e.readonly=!1,e.disabled=!1,e.classList.contains("em-recurrence-frequency")&&e.dispatchEvent(new Event("change",{bubbles:!1}))}),e.querySelectorAll('input[data-undo][type="checkbox"]').forEach(e=>{e.checked="1"===e.dataset.undo}),e.querySelectorAll(".em-datepicker").forEach(function(e){e.closest(".reschedulable")&&(e.querySelectorAll("input.em-date-input").forEach(e=>{e.disabled=!0,e.value=""}),e.querySelectorAll(".em-date-input.disabled, .em-datepicker-dates").forEach(e=>{e.classList.add("disabled")}))}),em_setup_datepicker_dates(e),e.querySelectorAll("select.em-selectize.selectized").forEach(e=>{void 0!==e.dataset.undo&&e.selectize?.setValue(e.dataset.undo.split(",")),e.closest(".reschedulable")&&e.selectize?.disable()});let t=e.querySelector(".em-recurrence-timeranges");t&&(t.querySelector(".recurrence-timeranges-editor").innerHTML=t.querySelector(".recurrence-timeranges-undo").innerHTML),e.querySelectorAll(".reschedulable [name]:not(.selectized), .reschedulable button").forEach(e=>{e.disabled=!0}),e.querySelector('input[type="hidden"][data-nonce]').disabled=!0,e.querySelectorAll(".reschedule-trigger").forEach(e=>{e.disabled=!1}),delete e.dataset.rescheduled,e.classList.remove("advanced-modified","advanced-modified-dates"),emRecurrenceEditor.updateIntervalDescriptor(e),emRecurrenceEditor.updateIntervalSelectors(e),emRecurrenceEditor.updateDurationDescriptor(e)}),e.target.matches(".em-recurrence-type-exclude")?(r.querySelectorAll(".em-recurrence-set.new-recurrence-set").forEach(e=>e.querySelector(".em-recurrence-set-action-remove")?.click()),n.querySelector(".em-modal-content")?.append(c),c.querySelector("[data-nonce]").disabled=!0):e.target.matches('.em-recurrence-set[data-type="exclude"]')&&0===e.target.closest(".em-recurrence-type-exclude").querySelectorAll(".em-recurrence-set[data-rescheduled]").length&&n.querySelector(".em-modal-content")?.append(c),t.dispatchEvent(new CustomEvent("updateSetsCount")),t.dispatchEvent(new CustomEvent("setAdvancedDefaults",{bubbles:!0}))}),t.querySelectorAll(".em-recurrence-set").forEach(function(e){delete e.dataset.rescheduled;let t="exclude"===e.dataset.type?n:e.querySelector(".em-recurrence-set-reshedule-modal");e.querySelectorAll("button.reschedule-trigger").forEach(function(r){r.addEventListener("click",function(n){void 0!==e.dataset.rescheduled?a(r):(t.rescheduleButton=r,t.classList.toggle("primary-recurrence",e.dataset.primary),openModal(t))})}),"include"===e.dataset.type&&(t.addEventListener("em_modal_close",function(){e.append(t),delete t.rescheduleButton}),t.querySelector("button.reschedule-cancel")?.addEventListener("click",()=>closeModal(t)),t.querySelector("button.reschedule-confirm")?.addEventListener("click",function(r){a(t.rescheduleButton),e.querySelector(".em-recurrence-pattern")?.prepend(t.querySelector(".recurrence-reschedule-action")),e.dataset.rescheduled="1",closeModal(t)}),e.addEventListener("undo",function(){t.querySelector(".em-modal-content")?.append(e.querySelector(".recurrence-reschedule-action"))}))});let a=function(e){let t=e.closest(".reschedulable");t.querySelectorAll("[disabled]").forEach(e=>{e.disabled=!1}),t.querySelectorAll(".disabled").forEach(e=>{e.classList.remove("disabled")}),t.querySelectorAll(".em-datepicker-data input").forEach(e=>{e.dataset.undo=e.value}),t.querySelectorAll("select.em-selectize.selectized").forEach(function(e){e.selectize?.enable();let t=e.selectize?.getValue();t&&(e.dataset.undo=t.join())}),t.closest(".em-recurrence-set").querySelector(e.dataset.nonce).disabled=!1,t.querySelectorAll(".reschedule-trigger").forEach(e=>{e.disabled=!0})};t.querySelectorAll('.em-add-recurrence-set[data-type="exclude"]').forEach(function(e){e.addEventListener("click",function(e){if(r.querySelectorAll("[data-rescheduled]").length>0||!t.dataset.event_id){let e=new CustomEvent("addRecurrence",{bubbles:!0,detail:{type:"exclude"}});t.dispatchEvent(e)}else openModal(n)})}),n.addEventListener("em_modal_close",function(){r.append(n),delete n.rescheduleButton}),n.querySelector("button.reschedule-cancel")?.addEventListener("click",()=>closeModal(n)),n.querySelector("button.reschedule-confirm")?.addEventListener("click",function(e){let l;if(n.rescheduleButton)a(n.rescheduleButton),l=n.rescheduleButton.closest(".em-recurrence-set");else{let e=t.querySelector(".em-recurrence-type-exclude");e?.dispatchEvent(new CustomEvent("addRecurrence",{bubbles:!0})),l=e?.querySelector(".em-recurrence-set:last-child")}l&&(l.dataset.rescheduled="1"),r.firstElementChild.after(c),c.querySelector("[data-nonce]").disabled=!1,closeModal(n)}),t.addEventListener("updateSetsCount",function(){"0"===r.dataset.count&&n.querySelector(".em-modal-content")?.append(c)})}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets;document.addEventListener("em_luxon_ready",function(){t.addEventListener("setDateTimes",function(){let e=t.closest("form").querySelector(".event-form-when");if(e){let r,n,c,a,l,i,s=e.querySelector(".em-datepicker.em-event-dates"),o=e.querySelector(".em-timeranges"),d=jQuery(o.querySelector(".em-time-input.em-time-start")),u=jQuery(o.querySelector(".em-time-input.em-time-end")),m=luxon.DateTime,p=t.querySelector('.em-recurrence-set[data-primary="1"] select.recurrence_timezone')?.value;p=p?.replace(/\.5/g,":30")||p;let f=!0,h=new Set;if(t.querySelectorAll(".em-recurrence-type-include .em-recurrence-set").forEach(e=>{let t,s,o=e.querySelector(".em-recurrence-timezone select")?.value||p;if(o=o?.replace(/\.5/g,":30")||o,o&&h.add(o),"on"===e.querySelector("select.recurrence_freq")?.value){let r=e.querySelector(".em-on-selector .em-date-input")?._flatpickr?.selectedDates;r&&(r.sort(function(e,t){return e-t}),t=m.fromJSDate(r[0]),s=m.fromJSDate(r[r.length-1]))}else e.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(e=>{e._flatpickr?.selectedDates.length&&(e.closest(".em-datepicker-until")?e.classList.contains("em-date-input-start")?t=m.fromJSDate(e._flatpickr.selectedDates[0]):e.classList.contains("em-date-input-end")&&(s=m.fromJSDate(e._flatpickr.selectedDates[0])):e.closest(".em-datepicker-range")&&(t=m.fromJSDate(e._flatpickr.selectedDates[0]),s=e._flatpickr.selectedDates.length>=2?m.fromJSDate(e._flatpickr.selectedDates[1]):t),l??=t,i??=s)});if(t??=l,s??=i||l,t=t?.setZone(o,{keepLocalTime:!0}),s=s?.setZone(o,{keepLocalTime:!0}),t&&s){let l=e.querySelector(".em-timeranges");if(l&&(e.dataset.primary||e.querySelector(".recurrences-timeranges-default-trigger")?.checked)){let i=jQuery(l.querySelector(".em-time-input.earliest-time")),o=jQuery(l.querySelector(".em-time-input.latest-time"));if("1"===l.dataset.allday)s=s.endOf("day"),c|=0,a|=86399;else{f=!1;let e=i.em_timepicker("getSecondsFromMidnight");if(t=i.val()?t.plus({seconds:e}):t.plus({seconds:c||0}),o.val()){let e=o.em_timepicker("getSecondsFromMidnight");s=s.plus({seconds:e})}else s=s.plus({seconds:a||0});c|=i.em_timepicker("getSecondsFromMidnight"),a|=o.em_timepicker("getSecondsFromMidnight")}let d=e.querySelector(".recurrence_duration")?.value;d&&(s=s.plus({days:d})),t.isValid&&(!r||t<r)&&(r=t.setZone(p)),s.isValid&&(!n||s>n)&&(n=s.setZone(p))}}}),r?.isValid&&n?.isValid){let t=r.setZone("system",{keepLocalTime:!0}).toJSDate(),c=n.setZone("system",{keepLocalTime:!0}).toJSDate();s.classList.contains("em-datepicker-range")?s.querySelector(".em-date-input.flatpickr-input")?._flatpickr?.setDate([t,c],!0):(s.querySelector(".em-date-input-start.flatpickr-input")?._flatpickr?.setDate(t,!0),s.querySelector(".em-date-input-end.flatpickr-input")?._flatpickr?.setDate(c,!0)),d.em_timepicker("setTime",t),u.em_timepicker("setTime",c);let a=e.querySelector(".recurring-summary-dates");if(a){a.classList.remove("hidden");let t="D",c=1==EM.show24hours?"H:mm":"h:mm a",l=a.querySelector(".date.start-date");l&&(l.textContent=r.toFormat(t));let i=a.querySelector(".time.start-time");i&&(i.textContent=" @ "+r.toFormat(c));let s=a.querySelector(".date.end-date");s&&(s.textContent=n.toFormat(t));let d=a.querySelector(".time.end-time");d&&(d.textContent=" @ "+n.toFormat(c)),a.classList.remove("is-all-day","has-all-day"),"1"===o.dataset.allday?a.classList.add("is-all-day"):f&&a.classList.add("has-all-day");let u=a.querySelector(".recurring-timezone .timezone");u&&p&&(u.textContent=p),h.size>1?a.classList.add("has-multiple-timezones"):a.classList.remove("has-multiple-timezones");let m=e.querySelector(".recurring-summary-missing");m&&m.classList.add("hidden")}}}})});let r={small:500,large:!1},n=document.querySelectorAll(".em-recurring-summary .recurring-summary-dates");n.length>0&&EM_ResizeObserver(r,n)});let emRecurrenceEditor={updateIntervalDescriptor:function(e){(e.matches(".em-recurrence-sets")?e.querySelectorAll(".em-recurrence-set"):[e.closest(".em-recurrence-set")]).forEach(function(e){e.querySelectorAll(".interval-desc").forEach(e=>e.classList.add("hidden"));let t="-plural",r=e.querySelector("input.em-recurrence-interval");r&&("1"!==r.value&&""!==r.value||(t="-singular"));let n=e.querySelector("select.em-recurrence-frequency"),c=n?n.value:"",a="span.interval-desc.interval-"+c+t;e.querySelectorAll(a).forEach(e=>e.classList.remove("hidden")),e.querySelectorAll(".interval-desc-intro").forEach(e=>e.classList.toggle("hidden","on"===c))})},updateDurationDescriptor:function(e){(e.matches(".em-recurrence-sets")?e.querySelectorAll(".em-recurrence-set"):[e.closest(".em-recurrence-set")]).forEach(function(e){e.querySelectorAll(".recurrence-days-desc").forEach(e=>e.classList.add("hidden"));let t=e.querySelector("input.em-recurrence-duration"),r=t&&("1"===t.value||""===t.value&&"1"===t.placeholder)?"singular":"plural";e.querySelectorAll(".recurrence-days-desc.em-"+r).forEach(e=>e.classList.remove("hidden"))})},updateIntervalSelectors:function(e){(e.matches(".em-recurrence-sets")?e.querySelectorAll(".em-recurrence-set"):[e.closest(".em-recurrence-set")]).forEach(function(e){e.querySelectorAll(".alternate-selector").forEach(e=>e.classList.add("hidden"));let t=e.querySelector("select.em-recurrence-frequency"),r=t?t.value:"";e.querySelectorAll(".em-"+r+"-selector").forEach(e=>e.classList.remove("hidden")),e.querySelectorAll(".em-recurrence-interval").forEach(e=>e.classList.toggle("hidden","on"===r))})}};document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets;t.addEventListener("setAdvancedDefaults",function(){let e=t.querySelector(".em-recurrence-type-include .em-recurrence-set:first-child"),r=".em-recurrence-type-include .em-recurrence-set:not(:first-child) .em-recurrence-advanced";t.querySelectorAll(".em-recurrence-set").forEach(e=>{e.dataset.primaryModified="0"}),t.querySelectorAll(".em-recurrence-set").forEach(t=>{t!==e&&t.querySelector(".recurrences-timeranges-default-trigger")?.checked&&(t.dataset.primaryModified="1")}),t.querySelectorAll(".em-recurrence-set").forEach(function(t){t.matches(".em-recurrence-type-include .em-recurrence-set:first-child")||e.querySelectorAll(".em-recurrence-advanced .em-datepicker .em-date-input.flatpickr-input").forEach(function(e){let r=e.closest(".em-datepicker"),n=e._flatpickr.altInput.value,c=e._flatpickr._inputData.some(e=>e.value!==e.dataset.undo),a=".em-recurrence-dates .em-date-input.form-control";r.classList.contains("em-datepicker-range")?t.querySelectorAll(a).forEach(function(e){e.previousElementSibling.placeholder||=e.placeholder,e.placeholder=n||e.previousElementSibling.placeholder,""===e.value&&c&&(e.closest(".em-recurrence-set").dataset.primaryModified="1")}):r.classList.contains("em-datepicker-until")&&(a+=e.classList.contains("em-date-input-start")?".em-date-input-start":".em-date-input-end",t.querySelectorAll(a).forEach(function(e){e.placeholder=n||e.previousElementSibling.placeholder,""===e.value&&c&&(e.closest(".em-recurrence-set").dataset.primaryModified="1")}))})}),["timezone","status"].forEach(function(n){const c=".em-recurrence-"+n;let a=e.querySelector(c+" select");if(a){("timezone"===n?[r,".em-recurrence-type-exclude .em-recurrence-set .em-recurrence-advanced"]:[r]).forEach(function(e){t.querySelectorAll(e+" "+c+" select").forEach(function(e){e.selectize&&(a.value?(e.selectize.settings.placeholder=a.querySelector(`option[value="${a.value}"]`)?.textContent||a.value,e.selectize.updatePlaceholder(),""===e.value&&a.value!==a.dataset.undo&&(e.closest(".em-recurrence-set").dataset.primaryModified="1")):(e.selectize.settings.placeholder=a.selectize?.settings.placeholder,e.selectize.updatePlaceholder()))})})}});let n=e.querySelector("input.em-recurrence-duration");n&&n.value.trim()&&t.querySelectorAll(r+" input.em-recurrence-duration").forEach(function(e){e.placeholder=n.value.trim(),""===e.value&&n.value!==n.dataset.undo&&(e.closest(".em-recurrence-set").dataset.primaryModified="1")}),t.querySelectorAll(".em-recurrence-set").forEach(function(e){e.classList.toggle("advanced-modified-primary","1"===e.dataset.primaryModified),e.dataset.primaryModified&&e.dispatchEvent(new Event("change",{bubbles:!0})),delete e.dataset.primaryModified;let t,r=0,n=!1,c=!1,a=!1,l=!1;"on"===e.querySelector("select.em-recurrence-frequency")?.value?r=2:e.querySelectorAll(".em-recurrence-dates .em-datepicker-data input[name]").forEach(function(e){r+=e.value?1:0,e.matches(":first-of-type")&&(n=!!e.value,c=e.value!==e.dataset.undo),e.matches(":last-of-type")&&(a=!!e.value,l=e.value!==e.dataset.undo),t||=e.value!==e.dataset.undo}),e.classList.toggle("has-date-range",r>=2),r<2&&(e.classList.toggle("has-date-range-start",n),e.classList.toggle("has-date-range-end",a)),c&&l?(e.classList.toggle("has-modified-date-range",!0),e.classList.toggle("has-modified-date-range-start",!1),e.classList.toggle("has-modified-date-range-end",!1)):(e.classList.toggle("has-modified-date-range",!1),e.classList.toggle("has-modified-date-range-start",c),e.classList.toggle("has-modified-date-range-end",l))}),t.dispatchEvent(new Event("updateRecurrenceSummary",{bubbles:!0}))}),t.addEventListener("updateSetsCount",function(){["include","exclude"].forEach(function(e){let r=t.querySelector(".em-recurrence-type-"+e);if(r){let n=r.querySelectorAll(".em-recurrence-set").length;t.setAttribute("data-"+e+"-count",n),r.dataset.count=n}})}),t.addEventListener("updateRecurrenceOrder",function(){let e;t.querySelectorAll(".em-recurrence-type-include .em-recurrence-set").forEach(function(r,n){let c=r.querySelector(".em-recurrence-order");c&&(c.value=n+1),r.classList.toggle("show-advanced",0===n),r!==e&&0===n&&(e=r,e.querySelectorAll("[data-placeholder]").forEach(e=>{e.placeholder=e.dataset.placeholder}),e.querySelectorAll(".em-datepicker .em-date-input-end.form-control").forEach(e=>{e.placeholder=e.previousElementSibling.placeholder}),e.querySelectorAll(".em-datepicker .em-date-input-start.form-control").forEach(e=>{e.placeholder=e.previousElementSibling.placeholder}),t.dispatchEvent(new CustomEvent("updateSetsCount")),t.dispatchEvent(new CustomEvent("setAdvancedDefaults")),t.dispatchEvent(new CustomEvent("updateRecurrenceSummary"))),r.matches(":first-child")?(r.dataset.primary="1",r.querySelectorAll(".em-time-all-day").forEach(e=>{e.indeterminate=!1})):delete r.dataset.primary})}),t.dispatchEvent(new CustomEvent("updateSetsCount")),emRecurrenceEditor.updateIntervalDescriptor(t),emRecurrenceEditor.updateIntervalSelectors(t),emRecurrenceEditor.updateDurationDescriptor(t)}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets;t.addEventListener("keyup",function(e){e.target.matches("input.em-recurrence-interval")?emRecurrenceEditor.updateIntervalDescriptor(e.target.closest(".em-recurrence-set")):e.target.matches("input.em-recurrence-duration")&&emRecurrenceEditor.updateDurationDescriptor(e.target.closest(".em-recurrence-set"))}),t.addEventListener("change",function(e){if(e.target.matches("select.em-recurrence-frequency")){let t=e.target.closest(".em-recurrence-set");emRecurrenceEditor.updateIntervalDescriptor(t),emRecurrenceEditor.updateIntervalSelectors(t)}})}),document.querySelectorAll("form.em-event-admin-recurring").forEach(e=>{e.addEventListener("submit",function(t){let r,n=e.querySelector('input[name="event_recreate_tickets"]');n&&"1"===n.value&&(r=EM.event_recurrence_bookings),r&&!confirm(r)&&t.preventDefault()})}),document.querySelectorAll(".em-reschedule-trigger, .em-reschedule-cancel").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget,r=t.matches(".em-reschedule-trigger");t.closest(".em-recurrence-reschedule")?.querySelector(t.dataset.target)?.classList.toggle("reschedule-hidden",!r),t.parentElement.querySelectorAll("[data-nonce]").forEach(e=>{e.disabled=!r}),t.parentElement.querySelectorAll("button").forEach(e=>e.classList.remove("reschedule-hidden")),t.classList.add("reschedule-hidden")})}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets,r=()=>t.dispatchEvent(new CustomEvent("setAdvancedDefaults")),n=()=>t.dispatchEvent(new CustomEvent("setDateTimes"));t.addEventListener("click",function(e){const t=e.target.closest(".em-recurrence-set-action-advanced");if(!t)return;const r=t.closest(".em-recurrence-set");r.classList.toggle("show-advanced"),"_tippy"in t&&(r.classList.contains("show-advanced")?t._tippy.setContent(t.getAttribute("data-label-hide")):t._tippy.setContent(t.getAttribute("data-label-show")))});let c=function(e){const t=e.querySelector(".em-recurrence-advanced"),r=e.querySelector(".em-recurrence-set-action-advanced");if(!t||!r)return;const n=t.querySelectorAll("input, select, textarea");let c=Array.from(n).some(e=>"checkbox"===e.type?e.checked:""!==e.value.trim());e.classList.toggle("has-advanced-value",c)};t.addEventListener("change",function(e){e.target.closest(".em-recurrence-advanced")&&c(e.target.closest(".em-recurrence-set"))}),t.querySelectorAll(".em-recurrence-set").forEach(e=>c(e)),t.querySelectorAll(".em-recurrence-type").forEach(function(e){e.addEventListener("change",function(t){let c=t.target.closest(".em-recurrence-set");if(t.target.closest(".em-recurrence-advanced"))e.classList.contains("em-recurrence-type-include")&&(c===c.parentElement?.firstElementChild&&r(),n()),(e=>{e.dispatchEvent(new CustomEvent("updateRecurrenceSummary",{bubbles:!0}))})(c);else if("on"===c?.querySelector("select.recurrence_freq")?.value){if(t.target.closest(".em-datepicker.em-on-selector")){let n=t.target.closest(".em-date-input")?._flatpickr?.selectedDates;if(n){n.sort(function(e,t){return e-t});let t=c.querySelector(".em-recurrence-dates.em-datepicker");if(t)if(t.classList.contains("em-datepicker-until"))t.querySelector(".em-date-input-start")?._flatpickr?.setDate(n[0]),t.querySelector(".em-date-input-end")?._flatpickr?.setDate(n[n.length-1]);else if(t.classList.contains("em-datepicker-range")){let e=[n[0],n[n.length-1]];t.querySelector(".em-date-input")?._flatpickr?.setDate(e)}e.classList.contains("em-recurrence-type-include")&&c===c.parentElement?.firstElementChild&&r()}}n()}})}),t.addEventListener("change",function(e){if(e.target.closest(".em-recurrence-advanced")){let r=e.target.closest(".em-recurrence-set"),n=!1;r.querySelectorAll(".em-recurrence-advanced [name]:not([disabled]):not([data-nonce]").forEach(e=>{e.name&&e.dataset.undo?"checkbox"===e.type?e.checked&&"1"!==e.dataset.undo&&(n=!0):e.value!==e.dataset.undo&&(n=!0):t.dataset.event_id&&e.value&&(n=!0)}),r.classList.toggle("advanced-modified",n)}if(e.target.matches(".em-recurrence-timeranges *")){let r=e.target.closest(".em-recurrence-set"),n=(r.querySelector(".em-recurrence-timeranges .em.timeranges"),r.querySelector(".em-time-input.em-time-start.earliest-time")),c=r.querySelector(".em-time-input.em-time-end.latest-time"),a=r.querySelector("input.em-recurrence-duration");if(!(a?.value>0||a?.placeholder>0||!1)){let r=n.dataset.seconds?parseInt(n.dataset.seconds):null,a=c.dataset.seconds?parseInt(c.dataset.seconds):null;if(!r||!a){let e=t.querySelector('.em-recurrence-set[data-type="include"]:first-child');if(e){if(null===r){let t=e.querySelector(".em-time-input.em-time-start")?.dataset.seconds;r=void 0===t?null:parseInt(e.querySelector(".em-time-input.em-time-start")?.dataset.seconds||0)}if(null===a){let t=e.querySelector(".em-time-input.em-time-end")?.dataset.seconds;a=void 0===t?null:parseInt(e.querySelector(".em-time-input.em-time-end")?.dataset.seconds||0)}}}null!==r&&null!==a&&(e.target.matches(".em-time-start")&&r>a&&(c.value=n.value,c.dispatchEvent(new Event("change"))),e.target.matches(".em-time-end")&&r>a&&(n.value=c.value,n.dispatchEvent(new Event("change"))))}}if(e.target.matches("input.em-recurrence-duration")&&("0"===e.target.value||""===e.target.value&&"0"===e.target.placeholder)){let r=e.target.closest(".em-recurrence-set");(r.dataset.primary?r:t).querySelectorAll(".em-recurrence-times .em-time-end").forEach(e=>e.dispatchEvent(new Event("change")))}let r=t.querySelector(".em-recurrence-set[data-primary] .em-time-all-day");if(e.target.matches(".em-time-all-day")){let t=e.target;t.matches(".em-recurrence-set[data-primary] .em-time-all-day")?t.readOnly&&(t.checked=!0,t.readOnly=!1):t.readOnly?(t.checked=!0,t.readOnly=!1):t.checked&&r.checked&&(t.readOnly=!0,t.indeterminate=!0,t.closest(".em-time-range").querySelectorAll(".em-time-input").forEach(e=>{e.value=""}))}}),t.addEventListener("updateRecurrenceSummary",function(e){let r=e.target.matches(".em-recurrence-set")?[e.target]:e.target.querySelectorAll(".em-recurrence-set"),n=t.querySelector(".em-recurrence-set[data-primary] .em-recurrence-timeranges .em-timeranges");r.forEach(function(e){let t=e.querySelector(".advanced-summary");if(t){let r={start:"",end:"",startIsSet:!1,endIsSet:!1},c={start:n.dataset.start,end:n.dataset.end,startIsSet:!1,endIsSet:!1};if("on"===e.querySelector("select.recurrence_freq")?.value){let t=e.querySelector(".em-on-selector .em-date-input")?._flatpickr?.selectedDates;t&&(t.sort(function(e,t){return e-t}),r.start=t[0],r.startIsSet=!0,r.end=t[t.length-1],r.endIsSet=!0)}else{let t=e.querySelector(".em-recurrence-dates.em-datepicker");if(t.classList.contains("em-datepicker-until"))["start","end"].forEach(function(e){let n=t.querySelector(`.em-date-input-${e}`);n&&(n._flatpickr&&n._flatpickr.altInput&&n._flatpickr.selectedDates.length?(r[e]=n._flatpickr.altInput.value,r[e+"IsSet"]=!0):n.nextElementSibling&&(r[e]=n.nextElementSibling.value||n.nextElementSibling.placeholder))});else if(t.classList.contains("em-datepicker-range")){let e=t.querySelector(".em-date-input");e&&(e._flatpickr&&e._flatpickr.altInput&&e._flatpickr.selectedDates.length?(r.start=e._flatpickr.altInput.value,r.startIsSet=!0):e.nextElementSibling&&(r.start=e.nextElementSibling.value||e.nextElementSibling.placeholder))}}e.querySelector(".em-recurrence-timeranges .recurrence-timeranges-default input:checked")&&(timeranges=e.querySelector(".em-recurrence-timeranges .em.timeranges"),["start","end"].forEach(function(t){let r=e.querySelector(`.em-recurrence-times .em-time-${t}`);r&&(c[t]=timeranges.dataset[t],r.value&&(c[t+"IsSet"]=!!c[t]))}));let a=e.querySelector(".em-recurrence-timezone select"),l="";if(a){let t=a.value;l=t?a.querySelector(`option[value="${t}"]`)?.textContent||"":e.querySelector(".em-recurrence-timezone .selectize-input input")?.placeholder||""}let i=e.querySelector(".em-recurrence-duration input.em-recurrence-duration"),s=i&&(i.value.trim()||i.placeholder)||"0";emRecurrenceEditor.updateDurationDescriptor(e),4===Object.entries(r).length?(t.querySelectorAll(".start-date").forEach(e=>{e.textContent=r.start,e.classList.toggle("is-set",r.startIsSet)}),t.querySelectorAll(".end-date").forEach(e=>{e.textContent=r.end,e.classList.toggle("is-set",r.endIsSet)})):t.querySelectorAll(".dates").forEach(e=>{e.textContent=r.start,e.classList.toggle("is-set",r.startIsSet)}),t.querySelectorAll(".times").forEach(function(e){e.innerHTML=`<span class="start-time">${c.start}</span> - <span class="end-time">${c.end}</span>`,e.firstElementChild.classList.toggle("is-set",c.startIsSet),e.lastElementChild.classList.toggle("is-set",c.endIsSet)}),t.querySelector(".all-day")?.classList.toggle("is-set",e.querySelector(".em-time-all-day")?.checked),t.querySelectorAll(".timezone").forEach(e=>{e.textContent=l,e.classList.toggle("is-set",a?.value)}),t.querySelectorAll(".duration").forEach(e=>{e.textContent=s,e.classList.toggle("is-set",i&&""!==i.value)})}})})}),document.addEventListener("em_event_editor_recurrences",function(e){let t=e.detail.recurrenceSets,r=function(e){if(e===document){let e=t.querySelector(".em-recurrence-set-template");em_unsetup_ui_elements(e)}t.dispatchEvent(new CustomEvent("setAdvancedDefaults"));let r=t.closest("form").querySelector('input[name="event_type"]')?.value;if(e===document&&("recurring"===r||"repeating"===r)){let e=t.querySelector(".em-recurrence-type-include .em-recurrence-set:first-child");const r={".em-recurrence-timezone select":'select[name="event_timezone"]',".em-recurrence-status select":'select[name="event_active_status"]'};Object.entries(r).forEach(function([r,n]){let c=e.querySelector(r),a=t.closest("form").querySelector(".event-form-when"),l=a?.querySelector(n);if(c&&l){c.selectize?c.selectize.on("change",function(e){l.selectize?l.selectize.setValue(e,!0):(l.value=e,l.dispatchEvent(new Event("change",{bubbles:!0})))}):c.addEventListener("change",function(){l.selectize?l.selectize.setValue(c.value,!0):(l.value=c.value,l.dispatchEvent(new Event("change",{bubbles:!0})))});let e=c.selectize?c.selectize.getValue():c.value;e&&(l.selectize?l.selectize.setValue(e,!0):l.value=e)}})}};document.addEventListener("em_setup_ui_elements",function(e){r(e.detail.container)}),"complete"!==document.readyState&&"interactive"!==document.readyState||r(document)}),document.addEventListener("em_event_editor_loaded",function(e){const t=jQuery.noConflict();if(t("#em-tickets-form").length>0){document.getElementById("event-rsvp").addEventListener("click",function(e){const t=this.parentElement.querySelector("input.event_rsvp_delete[data-nonce]"),r=document.getElementById("event-rsvp-options");if(this.checked)r.classList.remove("hidden"),t.disabled=!0;else{confirm(EM.disable_bookings_warning)?(r.classList.add("hidden"),t.disabled=!1):e.preventDefault()}}),t("input#event-rsvp").is(":checked")?t("div#rsvp-data").fadeIn():t("div#rsvp-data").hide();var r=function(){t("#em-tickets-form table tbody tr.em-tickets-row").show(),t("#em-tickets-form table tbody tr.em-tickets-row-form").hide()};document.querySelectorAll('#em-tickets-form input.possibly-indeterminate[type="checkbox"], #em-tickets-form input[type="checkbox"][indeterminate]').forEach(e=>{e.hasAttribute("indeterminate")&&e.readOnly&&(e.indeterminate=!0),e.addEventListener("click",()=>{e.hasAttribute("indeterminate")&&!e.classList.contains("determinate")?(e.readOnly?(e.checked=!0,e.readOnly=!1):e.checked&&(e.readOnly=!0,e.indeterminate=!0),e.classList.contains("possibly-indeterminate")&&(e.nextElementSibling.value=e.indeterminate?"default":e.checked?1:0)):e.nextElementSibling.value=e.checked?1:0})}),t("#em-tickets-add").on("click",function(e){e.preventDefault(),r();var c=t("#em-tickets-form table tbody");c.first(".em-ticket-template").find("input.em-date-input.flatpickr-input").each(function(){"_flatpickr"in this&&this._flatpickr.destroy()});var a=c.length+1,l=c.first(".em-ticket-template").clone(!0).attr("id","em-ticket-"+a).removeClass("em-ticket-template").addClass("em-ticket").appendTo(t("#em-tickets-form table"));l.find("*[name]").each(function(e,r){(r=t(r)).attr("name",r.attr("name").replace("em_tickets[0]","em_tickets["+a+"]"))});let i=l.find(".ticket-dates-from-normal").first();if(i.attr("data-until-id")){let e=i.attr("data-until-id").replace("-0","-"+a);i.attr("data-until-id",e),l.find(".ticket-dates-to-normal").attr("id",i.attr("data-until-id"))}l.show().find(".ticket-actions-edit").trigger("click"),l.find(".em-time-input").off().each(function(e,t){"object"==typeof this.em_timepickerObj&&this.em_timepicker("remove")}),em_setup_ui_elements(l),t("html, body").animate({scrollTop:l.offset().top-30}),n(),l.find(".ticket_uuid").val("10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16)))}),t(document).on("click",".ticket-actions-edit",function(e){e.preventDefault(),r();var n=t(this).closest("tbody");return n.find("tr.em-tickets-row").hide(),n.find("tr.em-tickets-row-form").fadeIn(),!1}),t(document).on("click",".ticket-actions-edited",function(e){e.preventDefault();var r=t(this).closest("tbody"),n=r.attr("id").replace("em-ticket-","");return r.find(".em-tickets-row").fadeIn(),r.find(".em-tickets-row-form").hide(),r.find("*[name]").each(function(e,c){if("ticket_start_pub"==(c=t(c)).attr("name"))r.find("span.ticket_start").text(c.val());else if("ticket_end_pub"==c.attr("name"))r.find("span.ticket_end").text(c.val());else if(c.attr("name")=="em_tickets["+n+"][ticket_type]")"members"==c.find(":selected").val()&&r.find("span.ticket_name").prepend("* ");else if(c.attr("name")=="em_tickets["+n+"][ticket_start_recurring_days]"){var a="before"==r.find("select.ticket-dates-from-recurring-when").val()?"-"+c.val():c.val();""!=c.val()?(r.find("span.ticket_start_recurring_days").text(a),r.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").show()):(r.find("span.ticket_start_recurring_days").text(" - "),r.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").hide())}else if(c.attr("name")=="em_tickets["+n+"][ticket_end_recurring_days]"){a="before"==r.find("select.ticket-dates-to-recurring-when").val()?"-"+c.val():c.val();""!=c.val()?(r.find("span.ticket_end_recurring_days").text(a),r.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").show()):(r.find("span.ticket_end_recurring_days").text(" - "),r.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").hide())}else{var l=c.attr("name").replace("em_tickets["+n+"][","").replace("]","").replace("[]","");r.find(".em-tickets-row ."+l).text(c.val())}}),t(document).triggerHandler("em_maps_tickets_edit",[r,n,!0]),t("html, body").animate({scrollTop:r.parent().offset().top-30}),!1}),t(document).on("change",".em-ticket-form select.ticket_type",function(e){var r=t(this);let n=r.closest(".em-ticket-form");"members"===this.value||"-1"===this.value&&"members"===this.dataset.default?r.closest(".em-ticket-form").find(".ticket-roles").fadeIn():r.closest(".em-ticket-form").find(".ticket-roles").hide(),"-1"===this.value&&"members"===this.dataset.default?(n[0].querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(e=>{e.indeterminate=!0,e.classList.remove("determinate")}),n[0].querySelectorAll('.ticket-roles input[type="checkbox"]:not([indeterminate])').forEach(e=>{e.checked=!1})):"members"===this.value&&n[0].querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(e=>{e.indeterminate=!1,e.readOnly=!1,e.checked=!0,e.classList.add("determinate")})}),t(".em-ticket-form select.ticket_type").trigger("change"),t(document).on("change",'.em-ticket-form .ticket-roles input[type="checkbox"]',function(e){let t=this.closest(".em-ticket-form"),r=t.querySelector(".em-ticket-form select.ticket_type");"members"===r.dataset.default&&"-1"===r.value&&(r.value="members",t.querySelectorAll('.ticket-roles input[type="checkbox"][indeterminate]').forEach(e=>{e.indeterminate=!1,e.readOnly=!1,e.checked=!0,e.classList.add("determinate")}))}),t(document).on("click",".em-ticket-form .ticket-options-advanced",function(e){e.preventDefault();var r=t(this);r.hasClass("show")?(r.closest(".em-ticket-form").find(".em-ticket-form-advanced").fadeIn(),r.find(".show,.show-advanced").hide(),r.find(".hide,.hide-advanced").show()):(r.closest(".em-ticket-form").find(".em-ticket-form-advanced").hide(),r.find(".show,.show-advanced").show(),r.find(".hide,.hide-advanced").hide()),r.toggleClass("show")}),t(".em-ticket-form").each(function(){var e=!1,r=t(this);r.find('.em-ticket-form-advanced input[type="text"]').each(function(){""!=this.value&&(e=!0)}),r.find('.em-ticket-form-advanced input[type="checkbox"]:checked').length>0&&(e=!0),r.find(".em-ticket-form-advanced option:selected").each(function(){""!=this.value&&(e=!0)}),e&&r.find(".ticket-options-advanced").trigger("click")}),t(document).on("click",".ticket-actions-delete",function(e){e.preventDefault();var r=t(this).closest("tbody");if(r.find("input.ticket_id").val()>0){let e=this.classList.contains("parent-ticket")?EM.eventEditor.deleteTicketParentWarning:EM.eventEditor.deleteTicketWarning;confirm(e)&&(r.find("input.delete[data-nonce]").prop("disabled",!1),r.closest(".em-ticket").addClass("ticket-deleted"))}else r.remove();return n(),!1}),t("#em-tickets-form.em-tickets-sortable table").sortable({items:"> tbody",placeholder:"em-ticket-sortable-placeholder",handle:".ticket-status",helper:function(e,r){var n=t(r).clone().addClass("em-ticket-sortable-helper"),c=n.find(".em-tickets-row td").length;return n.children().remove(),n.append('<tr class="em-tickets-row"><td colspan="'+c+'" style="text-align:left; padding-left:15px;"><span class="dashicons dashicons-tickets-alt"></span></td></tr>'),n}});var n=function(){var e=t("#em-tickets-form table tbody.em-ticket");1==e.length?(e.find(".ticket-status").addClass("single"),t("#em-tickets-form.em-tickets-sortable table").sortable("option","disabled",!0)):(e.find(".ticket-status").removeClass("single"),t("#em-tickets-form.em-tickets-sortable table").sortable("option","disabled",!1))};n()}});
//# sourceMappingURL=events-manager-event-editor.min.js.map